<html>
    <head>
        <link rel="stylesheet" href="/styles/global.css">
        <link rel="stylesheet" href="/styles/main.css">
        <title><%=locals.title || 'Public Folder'%></title>
    </head>
    <body>
        <%-include('partials/header')%>
        <section class="main">
            <div class="left-side">
                <p>Folder shared via puclic link</p>
            </div>
            <div class="main-content">
                <div class="navigation-state">
                    <%if(locals.path) {%>
                        <p>
                            <%path.forEach((pathObj, index) => {%>
                                <%=index > 0 ? '>': null%> <a href=<%=pathObj.folderHref%>> <%=pathObj.folderName%></a>
                            <%})%>
                        </p>
                    <%}%> 
                </div>
                <div class="content">
                            <%if(locals.userFiles) {%>
                                <div class="files-container">
                                    <%-include('partials/folderContent')%>
                                </div>
                            <%} else {%>
                                <div class="message-no-files">
                                    <p>no files or folders to display</p>
                                </div>
                            <%}%>
                </div>
            </div>

            <!-- file operations dialog -->
             <%if(locals.clickedFile) {%>
                <dialog id="file-operations">

                        <div>
                            <h3 class="file-name">
                                <p><%=clickedFile.name%></p>
                                <button id="closeFileOptions">
                                    <img src="/assets/icons/close.svg" alt="close">
                                </button>
                            </h3>
                            <div class="operations">
                                <ul>
                                    <li>
                                        <button id="file-option-details">
                                            <img src="/assets/icons/info.svg" alt="details" class="icon">
                                            <p class="operation">Details</p>
                                        </button>
                                    </li>

                                    <li>
                                        <a href="/files/download/<%=clickedFile.fileid%>">
                                            <img src="/assets/icons/download.svg" alt="download" class="icon">
                                            <p class="operation">Download</p>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                </dialog>

                <dialog id="file-details">
                    <div>
                        <div class="head">
                            <p>Details</p>
                            <button id="closeFileDetails">
                                <img src="/assets/icons/close.svg" alt="close">
                            </button>
                        </div>
                        <div class="details">
                            <div class="name-container">
                                <p class="name"><%=clickedFile.name%></p>
                                <p class="date"><%=clickedFile.createdDate%></p>
                            </div>
                            <div class="inner-details">
                                <ul>
                                    <li>
                                        <p>Uplaoded date:</p>
                                        <span><%=clickedFile.name%></span>
                                    </li>
                                    <li>
                                        <p>Type:</p>
                                        <span><%=clickedFile.mimetype%></span>
                                    </li>
                                    <li>
                                        <p>Size:</p>
                                        <span><%=clickedFile.size%></span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </dialog>

                <script>
                    const fileOperations = document.querySelector('#file-operations');
                    const closeFileOptions = document.querySelector('#closeFileOptions');

                    fileOperations.showModal()
                    closeFileOptions.addEventListener('click', ()=> fileOperations.close())

                    const fileOptionsDetailsBtn = document.querySelector('#file-option-details');
                     const fileDetailsDialog = document.querySelector('#file-details')
                     fileOptionsDetailsBtn.addEventListener('click', ()=> {
                         fileOperations.close()
                         fileDetailsDialog.showModal()
                     })

                     const closeFileDetails = document.querySelector('#closeFileDetails');
                     closeFileDetails.addEventListener('click', ()=> {
                         fileDetailsDialog.close();
                     })
                </script>
            <%}%>
        </section>
    </body>
</html>