<html>
    <head>
        <link rel="stylesheet" href="/styles/global.css">
        <link rel="stylesheet" href="/styles/main.css">
        <title>dome</title>
    </head>
    <body>
        <%-include('partials/header')%>
        
        <section class="main">
            <div class="left-side">
                <div class="btns-container">
                    <div id="newFolderBtn" class="btn">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>folder-plus-outline</title><path d="M13 19C13 19.34 13.04 19.67 13.09 20H4C2.9 20 2 19.11 2 18V6C2 4.89 2.89 4 4 4H10L12 6H20C21.1 6 22 6.89 22 8V13.81C21.39 13.46 20.72 13.22 20 13.09V8H4V18H13.09C13.04 18.33 13 18.66 13 19M20 18V15H18V18H15V20H18V23H20V20H23V18H20Z" /></svg>
                        New Folder
                    </div>
                    <div id="newFileBtn" class="btn">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>file-plus-outline</title><path d="M13.81 22H6C4.89 22 4 21.11 4 20V4C4 2.9 4.89 2 6 2H14L20 8V13.09C19.67 13.04 19.34 13 19 13S18.33 13.04 18 13.09V9H13V4H6V20H13.09C13.21 20.72 13.46 21.39 13.81 22M23 18H20V15H18V18H15V20H18V23H20V20H23V18Z" /></svg>
                        New File
                    </div>
                    <%if(locals.rootFolder){%>
                        <div id="deleteFolderBtn" class="btn">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>trash-can-outline</title><path d="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z" /></svg>
                            Delete Folder
                        </div>
                        <a href="/folders/share/<%=rootFolder.folderid%>" class="btn">
                            Share
                        </a>
                    <%}%>
                </div> 
            </div>

            <div class="main-content">
                <div class="navigation-state">
                    <%if(locals.path) {%>
                        <p>
                            <a href="/"><%=user.username%></a> 
                            <%path.forEach(pathObj => {%>
                                <%='>'%> <a href=<%=pathObj.folderHref%>> <%=pathObj.folderName%></a>
                            <%})%>
                        </p>
                    <%} else {%>
                            <p><a href="/"><%=user.username%></a></p>
                    <%}%>                            
                </div>
                <div class="content">
                    <div class="titles">
                        <div>Name</div>
                        <div>Size</div>
                        <div>Created</div>
                    </div>
                        <%if(userFiles) {%>
                            <div class="files-container">
                                <%-include('partials/folderContent')%>
                            </div>
                        <%} else {%>
                            <div class="message-no-files">
                                <%if(locals.rootFolder) { %>
                                    <p>no files or folders to display</p>
                                <%} else { %>
                                    <p>Create a new folder to get started</p>
                                <%}%>
                            </div>
                        <%}%>
                </div>
            </div>

    
            <!-- aside to appear file info -->
             <%if(locals.clickedFile) {%>
                <aside class="side" id="sideOfFileInfo">
                    <div class="head">
                        <h2>File Information</h2>
                        <button class="closeSide">X</button>
                    </div>
                    <div class="info">
                        <p>
                            <span>Name</span> : <%=clickedFile.name%>
                        </p>
                        <p>
                            <span>Type</span> : <%=clickedFile.mimetype%>
                        </p>
                        <p>
                            <span>Size</span> : <%=clickedFile.size%>
                        </p>
                        <p>
                            <span>Created</span> : <%=clickedFile.createdDate%> 
                        </p>
                    
                    </div>
                    <div class="btns">
                        <button class="closeSide">close</button>
                        <a href="/files/delete/<%=clickedFile.fileid%>">delete</a>
                        <a href="/files/download/<%=clickedFile.fileid%>" id="downloadBtn">download</a>
                    </div>
                </aside>

                <script>
                    const side = document.querySelector('#sideOfFileInfo') 
                    side.style.transform = 'scaleX(1)'
                </script>
            <%}%>
            
            <!-- uplaod file form -->
            <%-include('partials/uploadFileForm')%>
             <%if(messages.dialog == 'upload'){ %>
                <script>
                    const newFileDialog = document.querySelector('#newFileDialog');
                    newFileDialog.showModal()
                </script>
            <%}%>
            <!-- new folder form -->
            <%-include('partials/newFolderForm')%>
            <!-- delete folder dilaog -->
            <%if(locals.rootFolder) {%>
                <%-include('partials/deleteFolder', { folderid: rootFolder.folderid })%>
            <%}%>
        </section>

    </body>
    <script>
        const newFileBtn = document.getElementById('newFileBtn');
        const exitNewFileBtn = document.getElementById('exitNewFileBtn');


        const newFolderBtn = document.querySelector('#newFolderBtn');
        const newFolderDialog = document.querySelector('#newFolderDialog');
        const exitNewFolderBtn = document.querySelector('#exitNewFolderBtn')
        const folderNameInput = document.querySelector('input[name = \"folderName\"]')

        const deleteFolderBtn = document.querySelector('#deleteFolderBtn');
        const deleteDialog = document.querySelector('#deleteDialog');
        const cancelDelete = document.querySelector('#cancelDelete');
        const exitDeleteDialog = document.querySelector("#exitDeleteDialog")

        // for side that diplays file info
        const closeSideBtn = Array.from(document.querySelectorAll('.closeSide'))
        
 
        if(newFileBtn){
            newFileBtn.addEventListener('click', ()=> {
                newFileDialog.showModal()
            })
        }

        if(newFolderBtn){
            newFolderBtn.addEventListener('click', ()=> {
                newFolderDialog.showModal()
            })
        }

        exitNewFileBtn.addEventListener('click', ()=> {
            newFileDialog.close()
        })

        exitNewFolderBtn.addEventListener('click', ()=> {
            folderNameInput.value = ''
            newFolderDialog.close()
        })

        // about ensuring the delete process
        if(deleteFolderBtn) {
            deleteFolderBtn.addEventListener('click', ()=> {
                deleteDialog.showModal()
            })
        }

        if(cancelDelete) {
            cancelDelete.addEventListener('click', ()=> {
                deleteDialog.close()
            })
        }

        if(exitDeleteDialog) {
            exitDeleteDialog.addEventListener('click', ()=> {
                deleteDialog.close()
            })
        }

        // close the side 
        if(closeSideBtn.length > 0) {
            closeSideBtn.forEach(btn => {
                btn.addEventListener('click', ()=> {
                    side.style.transform = 'scaleX(0)'
                })
            })
        }

    </script>
</html>